<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Provisional Certificate</title>

<!-- ✅ html2pdf LIBRARY (MOST IMPORTANT FIX) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<button id="logoutBtn" style="
position:fixed;top:20px;right:20px;
padding:8px 16px;background:#dc3545;color:#fff;
border:none;border-radius:5px;cursor:pointer;z-index:9999;">
Logout
</button>

<style>
body{
  margin:0;
  font-family:Georgia,'Times New Roman',serif;
  background:#f3ead7;
}

/* NAV */
nav{
  position:fixed;top:0;left:0;width:100%;height:70px;
  background:#3a9aa4;display:flex;align-items:center;
  padding:0 30px;z-index:1000;
}
nav img{height:50px;}
nav h1{flex:1;text-align:center;color:#fff;font-size:28px;margin-left:350px;}
nav ul{list-style:none;display:flex;gap:25px;margin-right:150px;}
nav ul li a{color:#fff;text-decoration:none;font-weight:600;}

/* SEARCH CARD */
.search-card{
  max-width:360px;
  margin:130px auto;
  background:#f7f7f7;
  padding:25px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.1);
  text-align:center;
}
.input{
  width:100%;
  padding:10px;
  margin-bottom:12px;
  border:1px solid #ccc;
  border-radius:6px;
  text-align:center;
}
.btn{
  padding:10px 18px;
  background:#3a9aa4;
  border:none;
  color:#fff;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}
.btn:hover{background:#2e7f87}

/* ================= CERTIFICATE ================= */
.wrap{
  display:flex;
  justify-content:center;
  margin-top:110px;
}

.cert{
  width:210mm;
  height:148.5mm;
  position:relative;
  display:none;
  background-image:url("content/boarderimg.png");
  background-color: #feecc4;
  background-size:100% 100%;
  background-repeat:no-repeat;
  padding:90px 95px;
  box-sizing:border-box;
  box-shadow:0 18px 45px rgba(0,0,0,.35);
}

/* TOP LEFT LOGO */
.cert-logo{
  position:absolute;
  top:80px;
  left:85px;
  height:55px;
}

/* PC NUMBER */
.pc-no{
  position:absolute;
  top:65px;
  right:100px;
  font-size:13px;
  font-weight:700;
  color:#7a4f00;
}

/* HEAD */
.head{text-align:center;margin-top:-15px;}
.head .hindi{
  font-size:24px;
  color:#8b0000;
  font-weight:900;
}
.head .english{
  font-size:18px;
  color:#8b0000;
  font-weight:800;
  margin-top:-4px;
}
.head .sub{
  font-size:14px;
  color:#444;
  letter-spacing:1px;
  margin-top:6px;
}

/* BODY */
.body{
  margin-top:35px;
  font-size:15px;
  line-height:2;
}
.label{
  display:inline-block;
  width:150px;
  color:#555;
}
.value{
  font-weight:800;
  text-transform:uppercase;
}
#division{color:#8b0000;}

/* STAMP */
.cert-stamp-box{
  position:absolute;
  right:100px;
  bottom:175px;
}
.cert-stamp-box img{
  height:80px;
  opacity:0.85;
}

/* FOOTER */
.footer{
  position:absolute;
  bottom:62px;
  left:95px;
  right:95px;
  display:flex;
  justify-content:space-between;
}
.footer strong{
  font-size:16px;
  border-bottom:2px solid #b08a2e;
}

/* ACTION BUTTONS */
#certActions{
  display:none;
  justify-content:center;
  gap:20px;
  margin:25px auto;
}
#certActions .btn{
  background:linear-gradient(135deg,#caa24d,#f1d27a);
  color:#3b2600;
}
</style>
</head>

<body>

<nav>
  <a href="index.html"><img src="content/logo.jpeg"></a>
  <h1>Star Public School</h1>
  <ul>
    <li><a href="index.html">HOME</a></li>
    <li><a href="result.html">RESULT</a></li>
    <li><a href="">CONTACT</a></li>
  </ul>
</nav>

<div class="search-card">
  <h2>Search Result</h2>
  <input id="classInput" class="input" placeholder="Enter Class">
  <input id="rollInput" class="input" placeholder="Enter Roll Number">
  <button class="btn" id="searchBtn">Search</button>
</div>

<div class="wrap">
<div class="cert" id="certificate">

  <img src="content/logo.jpeg" class="cert-logo">

  <div class="pc-no">P.C. No. <span id="pcNo"></span></div>

  <div class="head">
    <div class="hindi">बिहार विद्यालय परीक्षा समिति, पटना</div>
    <div class="english">BIHAR SCHOOL EXAMINATION BOARD, PATNA</div>
    <div class="sub">PROVISIONAL CERTIFICATE</div>
  </div>

  <div class="body">
    Certified that <span class="value" id="studentName"></span>,
    Son/Daughter of <span class="value" id="fatherName"></span>,
    has passed the <span class="value" id="year"></span>
    from <span class="value" id="schoolName"></span>.
    <br><br>

    <div><span class="label">Class</span> <span class="value" id="classVal"></span></div>
    <div><span class="label">Roll No.</span> <span class="value" id="rollNo"></span></div>
    <div><span class="label">Division</span> <span class="value" id="division"></span></div>
  </div>

  <div class="cert-stamp-box">
    <img src="content/stamp.jpeg">
  </div>

  <div class="footer">
    <div>Patna, Dated: <span class="value" id="dateVal"></span></div>
    <div>
      <strong>Ajay Kumar Giri</strong><br>
      <small>Controller of Examination</small>
    </div>
  </div>

</div>
</div>

<div id="certActions">
  <button class="btn" id="searchMoreBtn">Search More</button>
  <button class="btn" id="downloadBtn">Download</button>
</div>

<script>
function fillCertificate(d){
  studentName.textContent=d.studentName||'';
  fatherName.textContent=d.fatherName||'';
  schoolName.textContent=d.schoolName||'';
  classVal.textContent=d.class||'';
  rollNo.textContent=d.rollNo||'';
  division.textContent=d.division||'';
  year.textContent=d.year||'';
  dateVal.textContent=d.date||'';
  pcNo.textContent=d.pcNo||'';
}

searchBtn.onclick=async()=>{
  const c=classInput.value.trim();
  const r=rollInput.value.trim();
  if(!c||!r) return alert("Enter Class & Roll");

  const res=await fetch(`/provisional?class=${c}&roll=${r}`);
  const data=await res.json();
  if(data.error) return alert(data.error);

  fillCertificate(data);
  document.querySelector('.search-card').style.display='none';
  certificate.style.display='block';
  certActions.style.display='flex';
}

searchMoreBtn.onclick=()=>{
  certificate.style.display='none';
  certActions.style.display='none';
  document.querySelector('.search-card').style.display='block';
}

downloadBtn.onclick=()=>{
  html2pdf().set({
    filename:'provisional.pdf',
    html2canvas:{ scale:3, useCORS:true },
    jsPDF:{ unit:'mm', format:'a5', orientation:'landscape' }
  }).from(document.getElementById('certificate')).save();
};
</script>

</body>
</html>

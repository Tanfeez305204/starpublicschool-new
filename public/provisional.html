<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bihar Provisional Certificate — Final (A5 Landscape)</title>
  <style>
    :root{
      --a5-w:210mm; --a5-h:148.5mm;
      --ivory:#fbf7f0;
      --soft-pink:#fde8f2;
      --accent-pink:#e79bbd;
      --gold:#d4b26f;
      --heading-red:#b20000;
      --text:#2b2023;
      --muted:#7b5860;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#fff,#fbf7f0);font-family:Georgia, 'Times New Roman', serif;color:var(--text)}
    .wrap{display:flex;justify-content:center;padding:18px}
    .cert{
      width:var(--a5-w);
      height:var(--a5-h);
      position:relative;
      box-sizing:border-box;
      padding:14mm 12mm;
      background:var(--ivory);
      overflow:hidden;
      border-radius:6px;
      background-image:
        linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.01)),
        radial-gradient(circle at 10% 20%, rgba(0,0,0,0.02), transparent 5%),
        radial-gradient(circle at 80% 80%, rgba(0,0,0,0.01), transparent 6%);
    }
    .cert-inner{position:absolute;inset:6px;border-radius:6px;padding:18px;box-sizing:border-box;background:transparent;border:6px solid rgb(226, 186, 148);}
    .corner{position:absolute;width:60px;height:60px;opacity:0.98}
    .corner.tl{left:6px;top:6px;background-image:radial-gradient(circle at 30% 30%,var(--accent-pink),transparent 35%), linear-gradient(135deg,var(--gold),var(--accent-pink));border-radius:8px;transform:rotate(0)}
    .corner.tr{right:6px;top:6px;background-image:radial-gradient(circle at 70% 30%,var(--accent-pink),transparent 35%), linear-gradient(225deg,var(--gold),var(--accent-pink));border-radius:8px;transform:rotate(90deg)}
    .corner.bl{left:6px;bottom:6px;background-image:radial-gradient(circle at 30% 70%,var(--accent-pink),transparent 35%), linear-gradient(315deg,var(--gold),var(--accent-pink));border-radius:8px;transform:rotate(270deg)}
    .corner.br{right:6px;bottom:6px;background-image:radial-gradient(circle at 70% 70%,var(--accent-pink),transparent 35%), linear-gradient(45deg,var(--gold),var(--accent-pink));border-radius:8px;transform:rotate(180deg)}
    .watermark{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) rotate(-28deg);text-align:center;pointer-events:none;white-space:nowrap;font-family:Georgia, 'Times New Roman', serif;color:rgba(189,149,140,0.10);font-weight:800;letter-spacing:6px;font-size:34px;text-transform:uppercase}
    .watermark .sub{display:block;font-size:18px;opacity:0.10;margin-top:6px}
    .pc-no{position:absolute;right:32px;top:20px;font-size:12px;color:var(--muted);font-weight:700}
    .head{ text-align:center;margin-top:6px }
    .head .hindi{font-size:22px;color:var(--heading-red);font-weight:800}
    .head .english{font-size:18px;color:var(--heading-red);font-weight:800;margin-top:4px}
    .head .sub{font-size:13px;color:var(--muted);font-weight:700;margin-top:6px}
    .body{margin-top:18px;padding:0 28px;font-size:14px;color:var(--text);line-height:1.9;text-align:left}
    .body .label{display:inline-block;width:170px;font-style:italic;color:var(--muted)}
    .body .value{font-weight:800;color:var(--text);text-transform:uppercase}
    .center-note{text-align:center;color:var(--muted);font-style:italic;margin-top:10px}
    .line-date{font-weight:800;color:var(--text);text-transform:uppercase;position:absolute;bottom:20px;left:68px;font-size:12px;font-weight:500;color:#444;font-family:"Times New Roman", serif;}
    .footer{position:absolute;bottom:22px;left:36px;right:36px;display:flex;justify-content:space-between;align-items:flex-end}
    .seal{width:92px;height:64px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.6), rgba(255,255,255,0.2));border:1px solid rgba(150,120,140,0.12);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:12px}
    .sign{text-align:right}
    .sign .name{color:var(--heading-red);font-weight:700;font-size:15px}
    .sign .role{font-size:12px;color:var(--muted)}
    .controls{display:flex;gap:10px;justify-content:center;margin-top:14px}
    .btn{background:linear-gradient(180deg,var(--accent-pink),var(--soft-pink));border:none;color:white;padding:9px 14px;border-radius:8px;cursor:pointer;font-weight:700;box-shadow:0 6px 12px rgba(0,0,0,0.06)}
    @media print {
      @page { size: A5 landscape; margin: 0; }
      body { background: #fffaf3 !important; margin:0; padding:0; -webkit-print-color-adjust: exact; print-color-adjust: exact;}
      .controls { display:none !important; }
      .wrap { width:100vw;height:100vh;padding:0; display:flex;align-items:center;justify-content:center; }
      .cert { width:100%; height:100%; margin:0; border:10px solid #c49a6c; border-radius:8px; box-shadow:none; background:#fffaf3; position:relative; transform:none !important;}
      .cert-inner { padding:20px 30px; box-sizing:border-box; position:relative; }
      .line { position:absolute; bottom:25px; right:40px; font-size:16px; color:#333; }
    }
    #rollNo {
  font-size: 18px; /* default 14px se bada */
  font-weight: 900;
}

  </style>
</head>
<body>
  <div class="wrap">
    <div class="cert" id="certificate">
      <div class="cert-inner"></div>
      <div class="corner tl" aria-hidden></div>
      <div class="corner tr" aria-hidden></div>
      <div class="corner bl" aria-hidden></div>
      <div class="corner br" aria-hidden></div>
      <div class="watermark">प्रमाण पत्र <span class="sub">PROVISIONAL CERTIFICATE</span></div>
      <div class="pc-no">P.C. No. <strong id="pcNo">840003510</strong></div>
      <div class="head">
        <div class="hindi">बिहार विद्यालय परीक्षा समिति, पटना</div>
        <div class="english">BIHAR SCHOOL EXAMINATION BOARD, PATNA</div>
        <div class="sub">औपवधिक प्रमाण-पत्र (PROVISIONAL CERTIFICATE) — Secondary School Examination</div>
      </div>
      <div class="body">
        <div class="line" style="margin-bottom:8px;">
  Certified that <span class="value" id="studentName">MEHAK NAJ</span>,
  Son/Daughter of <span class="value" id="fatherName"></span>,
  has passed the Secondary School Examination,
  <span class="value" id="year">2nD Term Exam 2025</span>,
  from <span class="value" id="schoolName">STAR PUBLIC SCHOOL,MATHIA</span>.
</div>

        <div class="line"><span class="label">Class</span> <span class="value" id="rollCode">84014</span></div>
        <div class="line"><span class="label">Roll No.</span> <span class="value" id="rollNo">2200279</span></div>
        <div class="line"><span class="label">Division</span> <span class="value" id="division">FIRST</span></div>
        <div class="center-note">(This is a computer generated provisional certificate)</div>
        <div style="height:12px"></div>
      </div>
      <div class="line-date">Patna, Dated: <span class="value" id="dateVal">31/03/2022</span></div>
      <div class="footer">
        <div class="seal">Board Seal</div>
        <div class="sign">
          <div class="name">Sanjaya Kumar</div>
          <div class="role">Controller of Examination</div>
        </div>
      </div>
    </div>
  </div>

  <!-- controls + search inputs -->
  <div class="controls" style="display:flex;justify-content:center;gap:10px;">
    <input id="classInput" placeholder="Class" />
    <input id="rollInput" placeholder="Roll" />
    <button class="btn" id="searchBtn">Search</button>
    <button class="btn" id="download">Download PDF</button>
    <button class="btn" id="printBtn">Print</button>
  </div>

  <script>
    document.getElementById('certificate').style.display='none';

    function fillCertificate(data){
      document.getElementById('studentName').textContent = data.studentName || '';
      document.getElementById('fatherName').textContent = data.fatherName || '';
      document.getElementById('schoolName').textContent = data.schoolName || '';
      document.getElementById('rollCode').textContent = data.class || '';
      document.getElementById('rollNo').textContent = data.rollNo || '';
      document.getElementById('year').textContent = data.year || '';
      document.getElementById('division').textContent = data.division || '';
      document.getElementById('dateVal').textContent = data.date || '';
      document.getElementById('pcNo').textContent = data.pcNo || '';
    }

    window.updateCertificate = fillCertificate;

    document.getElementById('searchBtn').addEventListener('click', async()=>{
      const cls=document.getElementById('classInput').value.trim();
      const roll=document.getElementById('rollInput').value.trim();
      if(!cls||!roll) return alert("Enter Class & Roll!");

      try{
        const res=await fetch(`/provisional?class=${cls}&roll=${roll}`);
        const data=await res.json();
        if(data.error) return alert(data.error);

        fillCertificate(data);
        document.getElementById('certificate').style.display='block';
      }catch(e){
        console.error(e); alert("Something went wrong!");
      }
    });

    document.getElementById('download').addEventListener('click',()=>{
      const cert=document.getElementById('certificate');
      if(cert.style.display==='none') return alert("Search first!");

      if(typeof html2pdf==='undefined'){
        const s=document.createElement('script');
        s.src='https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js';
        document.body.appendChild(s);
        s.onload=generatePdf;
      } else generatePdf();

      function generatePdf(){
        const wrapper=document.createElement('div');
        wrapper.style.width="210mm"; wrapper.style.height="148.5mm";
        wrapper.style.background="#ffffff"; wrapper.style.display="flex";
        wrapper.style.alignItems="center"; wrapper.style.justifyContent="center";
        wrapper.appendChild(cert.cloneNode(true));
        html2pdf().set({
          margin:[0,0,0,0],
          filename:(document.getElementById('studentName').textContent||'certificate')+'.pdf',
          image:{type:'jpeg',quality:1},
          html2canvas:{scale:4,useCORS:true,backgroundColor:"#ffffff",letterRendering:true},
          jsPDF:{unit:'mm',format:[210,148.5],orientation:'landscape'},
          pagebreak:{mode:['avoid-all']}
        }).from(wrapper).save();
      }
    });

    document.getElementById('printBtn').addEventListener('click',()=>window.print());
  </script>
</body>
</html>
